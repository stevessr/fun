# GitHub Actions å’Œè·¨å¹³å°æ„å»ºæ€»ç»“

æœ¬æ–‡æ¡£æ€»ç»“äº†ä¸º Dark Server Rust é¡¹ç›®æ·»åŠ çš„ GitHub Actions å·¥ä½œæµå’Œè·¨å¹³å°æ„å»ºåŠŸèƒ½ã€‚

## ğŸš€ å·²æ·»åŠ çš„åŠŸèƒ½

### 1. GitHub Actions å·¥ä½œæµ

#### `.github/workflows/ci.yml` - CI/CD æµæ°´çº¿
- **æµ‹è¯•é˜¶æ®µ**ï¼š
  - å¤šä¸ª Rust ç‰ˆæœ¬æµ‹è¯• (stable, beta, nightly)
  - ä»£ç æ ¼å¼æ£€æŸ¥ (`cargo fmt`)
  - é™æ€åˆ†æ (`cargo clippy`)
  - å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
  - å®‰å…¨å®¡è®¡ (`cargo audit`)

- **æ„å»ºé˜¶æ®µ**ï¼š
  - è·¨å¹³å°æ„å»ºæ”¯æŒ 6 ä¸ªç›®æ ‡å¹³å°
  - è‡ªåŠ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¼˜åŒ– (strip)
  - æ„å»ºäº§ç‰©ä¸Šä¼ 

- **Docker é˜¶æ®µ**ï¼š
  - å¤šæ¶æ„ Docker é•œåƒæ„å»º (amd64, arm64)
  - è‡ªåŠ¨æ¨é€åˆ° Docker Hub (å‘å¸ƒæ—¶)

#### `.github/workflows/release.yml` - å‘å¸ƒå·¥ä½œæµ
- **è‡ªåŠ¨åŒ–å‘å¸ƒ**ï¼š
  - æ ‡ç­¾åˆ›å»ºæ—¶è‡ªåŠ¨è§¦å‘
  - æ”¯æŒæ‰‹åŠ¨è§¦å‘ (workflow_dispatch)
  - ç”Ÿæˆå®Œæ•´çš„å‘å¸ƒè¯´æ˜

- **è·¨å¹³å°æ„å»º**ï¼š
  - Linux: x64, ARM64
  - macOS: Intel x64, Apple Silicon ARM64
  - Windows: x64, ARM64

- **å‘å¸ƒäº§ç‰©**ï¼š
  - è‡ªåŠ¨åˆ›å»ºå‹ç¼©åŒ… (tar.gz for Unix, zip for Windows)
  - ç”Ÿæˆ SHA256 æ ¡éªŒå’Œ
  - ä¸Šä¼ åˆ° GitHub Releases

### 2. æœ¬åœ°æ„å»ºè„šæœ¬

#### `build-cross-platform.sh` (Unix/Linux/macOS)
- **åŠŸèƒ½**ï¼š
  - è‡ªåŠ¨ä¾èµ–æ£€æŸ¥
  - äº¤å‰ç¼–è¯‘ç¯å¢ƒè®¾ç½®
  - å¤šå¹³å°å¹¶è¡Œæ„å»º
  - è‡ªåŠ¨æ‰“åŒ…å’Œå‹ç¼©
  - æ ¡éªŒå’Œç”Ÿæˆ

- **ä½¿ç”¨æ–¹æ³•**ï¼š
  ```bash
  ./build-cross-platform.sh [VERSION]
  ```

#### `build-cross-platform.ps1` (Windows PowerShell)
- **åŠŸèƒ½**ï¼šä¸ Unix è„šæœ¬ç›¸åŒçš„åŠŸèƒ½
- **ä½¿ç”¨æ–¹æ³•**ï¼š
  ```powershell
  .\build-cross-platform.ps1 [-Version <VERSION>]
  ```

### 3. éªŒè¯å’Œæµ‹è¯•è„šæœ¬

#### `verify-release.sh` - å‘å¸ƒéªŒè¯
- **åŠŸèƒ½**ï¼š
  - å‹ç¼©åŒ…å®Œæ•´æ€§æ£€æŸ¥
  - æ ¡éªŒå’ŒéªŒè¯
  - äºŒè¿›åˆ¶æ–‡ä»¶æ‰§è¡Œæµ‹è¯•
  - æ–‡ä»¶å¤§å°æ£€æŸ¥
  - ç”Ÿæˆå‘å¸ƒæŠ¥å‘Š

#### `test-binary.sh` - äºŒè¿›åˆ¶æµ‹è¯•
- **åŠŸèƒ½**ï¼š
  - äºŒè¿›åˆ¶æ–‡ä»¶åŸºæœ¬ä¿¡æ¯æ£€æŸ¥
  - å¯åŠ¨å’Œå…³é—­æµ‹è¯•
  - HTTP/WebSocket ç«¯ç‚¹æµ‹è¯•
  - æ€§èƒ½åŸºå‡†æµ‹è¯•
  - ä¾èµ–å…³ç³»æ£€æŸ¥

### 4. æ–‡æ¡£å’Œæ¨¡æ¿

#### `BUILD.md` - æ„å»ºæŒ‡å—
- è¯¦ç»†çš„æ„å»ºè¯´æ˜
- è·¨å¹³å°ç¼–è¯‘æŒ‡å¯¼
- æ•…éšœæ’é™¤æŒ‡å—
- æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### `.github/RELEASE_TEMPLATE.md` - å‘å¸ƒæ¨¡æ¿
- å‘å¸ƒæ£€æŸ¥æ¸…å•
- å‘å¸ƒè¯´æ˜æ¨¡æ¿
- ç‰ˆæœ¬å·è§„èŒƒ
- å‘å¸ƒæµç¨‹æŒ‡å¯¼

## ğŸ¯ æ”¯æŒçš„å¹³å°

| å¹³å° | æ¶æ„ | ç›®æ ‡ä¸‰å…ƒç»„ | äºŒè¿›åˆ¶åç§° | å‹ç¼©æ ¼å¼ |
|------|------|------------|------------|----------|
| Linux | x64 | `x86_64-unknown-linux-gnu` | `dark-server` | tar.gz |
| Linux | ARM64 | `aarch64-unknown-linux-gnu` | `dark-server` | tar.gz |
| macOS | Intel x64 | `x86_64-apple-darwin` | `dark-server` | tar.gz |
| macOS | Apple Silicon | `aarch64-apple-darwin` | `dark-server` | tar.gz |
| Windows | x64 | `x86_64-pc-windows-msvc` | `dark-server.exe` | zip |
| Windows | ARM64 | `aarch64-pc-windows-msvc` | `dark-server.exe` | zip |

## ğŸ”„ å·¥ä½œæµç¨‹

### è‡ªåŠ¨å‘å¸ƒæµç¨‹
1. **åˆ›å»ºæ ‡ç­¾**ï¼š`git tag v1.0.0 && git push origin v1.0.0`
2. **GitHub Actions è§¦å‘**ï¼šè‡ªåŠ¨å¼€å§‹æ„å»ºæ‰€æœ‰å¹³å°
3. **æ„å»ºå®Œæˆ**ï¼šç”Ÿæˆ 6 ä¸ªå¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶
4. **åˆ›å»ºå‘å¸ƒ**ï¼šè‡ªåŠ¨åˆ›å»º GitHub Release
5. **ä¸Šä¼ äº§ç‰©**ï¼šæ‰€æœ‰å‹ç¼©åŒ…å’Œæ ¡éªŒå’Œæ–‡ä»¶è‡ªåŠ¨ä¸Šä¼ 

### æœ¬åœ°æ„å»ºæµç¨‹
1. **è¿è¡Œæ„å»ºè„šæœ¬**ï¼š`./build-cross-platform.sh 1.0.0`
2. **éªŒè¯æ„å»º**ï¼š`./verify-release.sh`
3. **æµ‹è¯•äºŒè¿›åˆ¶**ï¼š`./test-binary.sh`
4. **æ‰‹åŠ¨å‘å¸ƒ**ï¼šä¸Šä¼ åˆ° GitHub Releases

## ğŸ“ è¾“å‡ºç»“æ„

æ„å»ºå®Œæˆåï¼Œ`releases/` ç›®å½•åŒ…å«ï¼š

```
releases/
â”œâ”€â”€ dark-server-v1.0.0-linux-x64/
â”œâ”€â”€ dark-server-v1.0.0-linux-x64.tar.gz
â”œâ”€â”€ dark-server-v1.0.0-linux-arm64/
â”œâ”€â”€ dark-server-v1.0.0-linux-arm64.tar.gz
â”œâ”€â”€ dark-server-v1.0.0-macos-x64/
â”œâ”€â”€ dark-server-v1.0.0-macos-x64.tar.gz
â”œâ”€â”€ dark-server-v1.0.0-macos-arm64/
â”œâ”€â”€ dark-server-v1.0.0-macos-arm64.tar.gz
â”œâ”€â”€ dark-server-v1.0.0-windows-x64/
â”œâ”€â”€ dark-server-v1.0.0-windows-x64.zip
â”œâ”€â”€ dark-server-v1.0.0-windows-arm64/
â”œâ”€â”€ dark-server-v1.0.0-windows-arm64.zip
â”œâ”€â”€ checksums.txt
â””â”€â”€ release-report.txt
```

## ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§

### äº¤å‰ç¼–è¯‘æ”¯æŒ
- ä½¿ç”¨ `cross` å·¥å…·è¿›è¡Œäº¤å‰ç¼–è¯‘
- è‡ªåŠ¨é…ç½®äº¤å‰ç¼–è¯‘ç¯å¢ƒ
- æ”¯æŒ ARM64 Linux äº¤å‰ç¼–è¯‘

### ä¼˜åŒ–ç‰¹æ€§
- å‘å¸ƒç‰ˆæœ¬ä¼˜åŒ– (`--release`)
- äºŒè¿›åˆ¶æ–‡ä»¶å‹ç¼© (`strip`)
- ç¼“å­˜ä¼˜åŒ– (GitHub Actions)
- å¹¶è¡Œæ„å»ºæ”¯æŒ

### å®‰å…¨ç‰¹æ€§
- è‡ªåŠ¨å®‰å…¨å®¡è®¡
- SHA256 æ ¡éªŒå’Œç”Ÿæˆ
- å¯é‡ç°æ„å»º
- æ— å¯†é’¥åµŒå…¥

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¼€å‘è€…
```bash
# æœ¬åœ°å¼€å‘
cargo run

# æœ¬åœ°æ„å»ºæ‰€æœ‰å¹³å°
./build-cross-platform.sh

# éªŒè¯æ„å»º
./verify-release.sh
```

### å‘å¸ƒç®¡ç†å‘˜
```bash
# åˆ›å»ºæ–°ç‰ˆæœ¬
git tag v1.0.0
git push origin v1.0.0

# GitHub Actions ä¼šè‡ªåŠ¨å¤„ç†å…¶ä½™å·¥ä½œ
```

### ç”¨æˆ·
```bash
# ä¸‹è½½é¢„æ„å»ºäºŒè¿›åˆ¶
curl -L https://github.com/stevessr/dark-server/releases/download/v1.0.0/dark-server-v1.0.0-linux-x64.tar.gz | tar -xz

# è¿è¡Œ
./dark-server
```

## ğŸ‰ ä¼˜åŠ¿

1. **å®Œå…¨è‡ªåŠ¨åŒ–**ï¼šä»ä»£ç æäº¤åˆ°å‘å¸ƒå®Œå…¨è‡ªåŠ¨åŒ–
2. **å¤šå¹³å°æ”¯æŒ**ï¼šæ”¯æŒæ‰€æœ‰ä¸»æµå¹³å°å’Œæ¶æ„
3. **è´¨é‡ä¿è¯**ï¼šå…¨é¢çš„æµ‹è¯•å’ŒéªŒè¯æµç¨‹
4. **ç”¨æˆ·å‹å¥½**ï¼šæä¾›é¢„æ„å»ºäºŒè¿›åˆ¶ï¼Œæ— éœ€ç¼–è¯‘
5. **å¼€å‘è€…å‹å¥½**ï¼šæœ¬åœ°æ„å»ºè„šæœ¬ï¼Œä¾¿äºå¼€å‘å’Œè°ƒè¯•
6. **å®‰å…¨å¯é **ï¼šæ ¡éªŒå’ŒéªŒè¯ï¼Œç¡®ä¿æ–‡ä»¶å®Œæ•´æ€§

## ğŸ“ ç»´æŠ¤è¯´æ˜

- **å®šæœŸæ›´æ–°**ï¼šä¿æŒ GitHub Actions ç‰ˆæœ¬æœ€æ–°
- **æµ‹è¯•éªŒè¯**ï¼šæ¯æ¬¡å‘å¸ƒå‰è¿è¡Œå®Œæ•´æµ‹è¯•
- **æ–‡æ¡£åŒæ­¥**ï¼šä¿æŒæ–‡æ¡£ä¸å®é™…åŠŸèƒ½åŒæ­¥
- **ç›‘æ§æ„å»º**ï¼šå…³æ³¨æ„å»ºå¤±è´¥å’Œæ€§èƒ½é—®é¢˜

è¿™å¥—å®Œæ•´çš„ CI/CD ç³»ç»Ÿç¡®ä¿äº† Dark Server é¡¹ç›®èƒ½å¤Ÿé«˜æ•ˆã€å¯é åœ°æ„å»ºå’Œå‘å¸ƒåˆ°æ‰€æœ‰æ”¯æŒçš„å¹³å°ã€‚
